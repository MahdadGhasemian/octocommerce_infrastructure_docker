version: '3.8'

services:
  nginx:
    image: {{ nginx_image }}
    container_name: {{ nginx_container_name }}
    volumes:
      - "{{ nginx_conf_path }}:/etc/nginx/conf.d/default.conf:ro"
    ports:
      - "{{ nginx_port }}:80"
    depends_on:
      - pgadmin4

  postgres:
    image: {{ postgres_image }}
    container_name: {{ postgres_container_name }}
    restart: always
    environment:
      POSTGRES_DB: {{ postgres_db }}
      POSTGRES_USER: {{ postgres_user }}
      POSTGRES_PASSWORD: {{ postgres_password }}
    volumes:
      - "{{ postgres_volume_name }}:/var/lib/postgresql/data"
    ports:
      - "{{ postgres_port }}:5432"
  
  pgadmin4:
    image: {{ pgadmin_image }}
    container_name: {{ pgadmin_container_name }}
    environment:
      PGADMIN_LISTEN_PORT: {{ pgadmin_listen_port }}
      PGADMIN_DEFAULT_EMAIL: {{ pgadminq_user }}
      PGADMIN_DEFAULT_PASSWORD: {{ pgadmin_password }}
    volumes:
      - "{{ pgadmin_volume_name }}:/var/lib/pgadmin"
    ports:
      - "{{ pgadmin_port }}:8080"
    depends_on:
      - postgres
  
  rabbitmq:
    image: {{ rabbitmq_image }}
    container_name: {{ rabbitmq_container_name }}
    restart: always
    environment:
      RABBITMQ_DEFAULT_USER: {{ rabbitmq_user }}
      RABBITMQ_DEFAULT_PASS: {{ rabbitmq_password }}
    volumes:
      - "{{ rabbitmq_volume_name }}:/var/lib/rabbitmq"
    ports:
      - "{{ rabbitmq_port }}:15672"
  
  redis:
    image: {{ redis_image }}
    container_name: {{ redis_container_name }}
    restart: always
    environment:
      ALLOW_EMPTY_PASSWORD: no
      REDIS_PASSWORD: {{ redis_password }}
    volumes:
      - "{{ redis_volume_name }}:/data"
    ports:
      - "{{ redis_port }}:6379"

  redis-insight:
    image: {{ redis_insight_image }}
    container_name: {{ redis_insight_container_name }}
    restart: always
    volumes:
      - "{{ redis_insight_volume_name }}:/data"
    ports:
      - "{{ redis_insight_port }}:5540"
  
  minio:
    image: {{ minio_image }}
    container_name: {{ minio_container_name }}
    restart: always
    environment:
      MINIO_ROOT_USER: {{ minio_root_user }}
      MINIO_ROOT_PASSWORD: {{ minio_root_password }}
    volumes:
      - "{{ minio_volume_name }}:/bitnami/minio/data"
    ports:
      - "{{ minio_server_port }}:9000"
      - "{{ minio_console_port }}:9001"

volumes:
  {{ postgres_volume_name }}:
  {{ rabbitmq_volume_name }}:
  {{ pgadmin_volume_name }}:
  {{ redis_volume_name }}:
  {{ redis_insight_volume_name }}:
  {{ minio_volume_name }}:
